document.addEventListener('DOMContentLoaded', onload);

function onload() {
  initialiseIcons();
  initialiseMapParkings();
  initialiseMapRoute();
  initialiseCarousel();
}

let iconCityHall;
let iconParking;
let iconBrunch;
const parkingLines = [];

function initialiseIcons() {
  iconCityHall = L.icon({
    iconUrl: 'pin_ring.png',
    iconSize: [48, 48],
    iconAnchor: [24, 48],
    popupAnchor: [0, -48]
  });
  iconParking = L.icon({
    iconUrl: 'pin_parking.png',
    iconSize: [48, 48],
    iconAnchor: [24, 48],
    popupAnchor: [0, -48]
  });
  iconBrunch = L.icon({
    iconUrl: 'pin_brunch.png',
    iconSize: [48, 48],
    iconAnchor: [24, 48],
    popupAnchor: [0, -48]
  });
}

function initialiseMapParkings() {
  const map = L.map('map_parkings').setView([51.05435031540796, 3.7228293370842573], 16);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.marker([51.054318, 3.725266], {icon:iconCityHall})
    .addTo(map)
    .bindPopup("Stadhuis Gent");

  L.marker([51.05540253906053, 3.726356147496037], {icon:iconParking})
    .addTo(map)
    .on('click', function () {
      swiper.slideToLoop(0);
    });
  parkingLines.push(L.polyline(
    [[51.054318,3.725266],[51.054314,3.725283],[51.054333,3.725301],[51.054355,3.725321],[51.054346,3.725347],[51.054315,3.725434],[51.054653,3.725727],[51.055261,3.72663],[51.055386,3.726339]]
    , { color: 'grey', weight: 3, dashArray: '5, 10' }
  ).addTo(map));

  L.marker([51.056463383573735, 3.725931648129965], {icon:iconParking})
    .addTo(map)
    .on('click', function () {
      swiper.slideToLoop(1);
    });;
  parkingLines.push(L.polyline(
    [[51.054318,3.725266],[51.054314,3.725283],[51.054333,3.725301],[51.054355,3.725321],[51.054346,3.725347],[51.054315,3.725434],[51.054653,3.725727],[51.055261,3.72663],[51.055728,3.72733],[51.056052,3.726632],[51.056303,3.726205],[51.056364,3.726091],[51.056452,3.725917]]
    , { color: 'grey', weight: 3, dashArray: '5, 10' }
  ).addTo(map));

  L.marker([51.052986544704346, 3.719579125309941], {icon:iconParking})
    .addTo(map)
    .on('click', function () {
      swiper.slideToLoop(2);
    });;
  parkingLines.push(L.polyline(
    [[51.054318,3.725266],[51.054314,3.725283],[51.054293,3.725263],[51.054269,3.725241],[51.054261,3.725267],[51.05423,3.725347],[51.054013,3.725078],[51.053923,3.724928],[51.053859,3.724831],[51.053769,3.724718],[51.053814,3.724546],[51.053865,3.724411],[51.053871,3.724391],[51.053859,3.724373],[51.053967,3.723999],[51.053816,3.723896],[51.053801,3.723746],[51.053757,3.723544],[51.053745,3.723497],[51.053643,3.723433],[51.053673,3.723219],[51.05372,3.722896],[51.053748,3.722703],[51.053869,3.721978],[51.053883,3.721829],[51.05389,3.721549],[51.053876,3.720941],[51.053875,3.720914],[51.053856,3.720196],[51.053855,3.720166],[51.053836,3.7197],[51.053791,3.719136],[51.053756,3.718896],[51.053727,3.718898],[51.05364,3.718906],[51.053552,3.718819],[51.053533,3.718801],[51.053421,3.719064],[51.053373,3.719397],[51.053344,3.719495],[51.053276,3.719598],[51.053215,3.719651],[51.052966,3.719674],[51.052965,3.71958]]
    , { color: 'grey', weight: 3, dashArray: '5, 10' }
  ).addTo(map));

  L.marker([51.05535733784029, 3.7164722768509955], {icon:iconParking})
    .addTo(map)
    .on('click', function () {
      swiper.slideToLoop(3);
    });;
  parkingLines.push(L.polyline(
    [[51.054318,3.725266],[51.054314,3.725283],[51.054293,3.725263],[51.054269,3.725241],[51.054261,3.725267],[51.05423,3.725347],[51.054013,3.725078],[51.053923,3.724928],[51.053859,3.724831],[51.053769,3.724718],[51.053814,3.724546],[51.053865,3.724411],[51.053871,3.724391],[51.053859,3.724373],[51.053967,3.723999],[51.053816,3.723896],[51.053801,3.723746],[51.053757,3.723544],[51.053745,3.723497],[51.053643,3.723433],[51.053673,3.723219],[51.05372,3.722896],[51.053748,3.722703],[51.053869,3.721978],[51.053883,3.721829],[51.05389,3.721549],[51.053876,3.720941],[51.053875,3.720914],[51.053856,3.720196],[51.053855,3.720166],[51.053836,3.7197],[51.053791,3.719136],[51.053756,3.718896],[51.053733,3.718653],[51.053759,3.718464],[51.053779,3.718407],[51.053896,3.718159],[51.054012,3.717893],[51.054118,3.717723],[51.054337,3.71744],[51.054413,3.717303],[51.054433,3.717207],[51.054489,3.716574],[51.05456,3.71655],[51.05484,3.716567],[51.055207,3.716637],[51.055274,3.716577],[51.055392,3.716546],[51.055378,3.716463]]
    , { color: 'grey', weight: 3, dashArray: '5, 10' }
  ).addTo(map));
}

function initialiseMapRoute() {
  const map = L.map('map_route').setView([51.04911237246672, 3.7220856785017915], 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.marker([51.054318, 3.725266], {icon:iconCityHall})
    .addTo(map)
    .bindPopup("Stadhuis Gent");

  L.marker([51.038993844912916, 3.715836726022294], {icon:iconBrunch})
    .addTo(map)
    .bindPopup("Alix - Maison d'Amis");

  L.polyline(
    [[51.054318,3.725266],[51.054314,3.725283],[51.054293,3.725263],[51.054269,3.725241],[51.054261,3.725267],[51.05423,3.725347],[51.054013,3.725078],[51.053923,3.724928],[51.053859,3.724831],[51.053769,3.724718],[51.053615,3.724584],[51.053545,3.724522],[51.053492,3.724493],[51.053371,3.72449],[51.052918,3.724639],[51.052877,3.724653],[51.052613,3.72474],[51.052407,3.724862],[51.05221,3.724993],[51.052209,3.724963],[51.052207,3.724592],[51.052218,3.722941],[51.052218,3.721888],[51.052217,3.720962],[51.052216,3.720881],[51.052214,3.720627],[51.052221,3.720532],[51.052217,3.720531],[51.051648,3.720428],[51.051416,3.720331],[51.051177,3.720199],[51.050658,3.719859],[51.05058,3.719807],[51.050141,3.719723],[51.049616,3.71967],[51.048968,3.719657],[51.048232,3.71979],[51.047913,3.719995],[51.047527,3.72019],[51.047187,3.720299],[51.047138,3.720278],[51.047075,3.720189],[51.047037,3.719953],[51.046874,3.719966],[51.046794,3.719977],[51.046756,3.719983],[51.046687,3.720512],[51.046712,3.720519],[51.046694,3.720621],[51.046567,3.720663],[51.04655,3.720623],[51.04633,3.720644],[51.046138,3.720716],[51.044949,3.720806],[51.044758,3.720798],[51.044519,3.720688],[51.044298,3.72054],[51.044116,3.720337],[51.043903,3.72002],[51.043649,3.71958],[51.043507,3.719288],[51.043575,3.719212],[51.04351,3.719072],[51.04337,3.718677],[51.04312,3.717929],[51.042966,3.717462],[51.042898,3.717593],[51.042745,3.717886],[51.042708,3.717952],[51.042641,3.717914],[51.042599,3.717853],[51.04256,3.717742],[51.04247,3.717913],[51.042216,3.717571],[51.041596,3.717179],[51.041436,3.717186],[51.040871,3.717381],[51.040812,3.717355],[51.040737,3.717521],[51.040628,3.717411],[51.04027,3.717107],[51.040195,3.717051],[51.040075,3.716962],[51.040005,3.716913],[51.039949,3.716872],[51.039112,3.716187],[51.038863,3.716046]]
    , { color: 'green', weight: 5 }
  ).addTo(map);

}

let swiper;
function initialiseCarousel() {
  swiper = new Swiper('.swiper', {
    loop: true,
    autoplay: {
      delay: 3000,      // time in ms between slides
      disableOnInteraction: true // keeps autoplay after user interaction
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    on: {
      realIndexChange: function () {
        onCarouselChange(this.realIndex);
      }
    }
  });
  onCarouselChange(0);
}

function onCarouselChange(index) {
  for(let i=0;i<parkingLines.length;i++) {
    parkingLines[i].setStyle(index === i ? {
      dashArray: null,
      weight: 5,
      color: 'green'
    } : {
      dashArray: '5, 10',
      weight: 3,
      color: 'grey'
    });
  }
  parkingLines[index].bringToFront();
}
